!function(){angular.module("acComponents.config",[]).value("acComponents.config",{debug:!0}).constant("AC_API_ROOT_URL","http://avalanche-canada-dev.elasticbeanstalk.com"),angular.module("acComponents.directives",[]),angular.module("acComponents.filters",[]),angular.module("acComponents.services",[]),angular.module("acComponents",["acComponents.config","acComponents.directives","acComponents.filters","acComponents.services","acComponents.templates","ngSanitize"]),angular.module("acComponents.directives").directive("acDrawer",function(){return{replace:!0,transclude:!0,templateUrl:"drawer.html",link:function(){}}}),angular.module("acComponents.directives").directive("acForecastMini",["AC_API_ROOT_URL",function(a){return{templateUrl:"forecast-mini.html",scope:{forecast:"=acForecast"},link:function(e,t){t.addClass("ac-forecast-mini"),e.apiUrl=a}}}]),angular.module("acComponents.directives").directive("acLoadingIndicator",function(){return{templateUrl:"loading-indicator.html",replace:!0,link:function(){}}}),angular.module("acComponents.directives").directive("acMapboxMap",["$rootScope","$window","$timeout","acBreakpoint","acObservation","acForecast","MAPBOX_ACCESS_TOKEN","MAPBOX_MAP_ID",function(a,e,t,n,r,s,o,i){return{template:'<div id="map"></div>',replace:!0,scope:{region:"=acRegion",regions:"=acRegions",obs:"=acObs"},link:function(t,l,c){function d(a){return function(){l.height($(e).height()-Number(a)),E.invalidateSize()}}function g(a){var e=E.getZoom()<=6?60:80;return L.icon({iconUrl:a.iconUrl||s.getDangerIconUrl(a.regionId),iconSize:[e,e],labelAnchor:[6,0]})}function p(){k.regions=L.geoJson(t.regions,{style:function(){return A.region.default},onEachFeature:function(a,e){function n(){if(E.getZoom()<9){var a=h();E.fitBounds(e.getBounds(),{paddingBottomRight:a})}k.currentRegion=e,t.$apply(function(){t.region=e})}if(e.bindLabel(a.properties.name),e.on("click",n),e.on("mouseover",function(){e==k.currentRegion?e.setStyle(A.region.selectedhover):e.setStyle(A.region.hover)}),e.on("mouseout",function(){e==k.currentRegion?e.setStyle(A.region.selected):e.setStyle(A.region.default)}),a.properties.centroid){var r=L.latLng(a.properties.centroid[1],a.properties.centroid[0]),s=L.marker(r),o=g({regionId:a.id});s.setIcon(o),s.setZIndexOffset(200),s.on("click",n),s.bindLabel(a.properties.name,{pane:"popupPane"}),k.dangerIcons.addLayer(s)}}}),v()}function v(){var a=E.getZoom();if(k.regions){var e=E.hasLayer(k.regions);6>a&&e?E.removeLayer(k.regions):a>=6&&!e?E.addLayer(k.regions):a>10&&e&&E.removeLayer(k.regions)}if(k.dangerIcons){var t=E.hasLayer(k.dangerIcons);E.getZoom()<6&&t?E.removeLayer(k.dangerIcons):E.getZoom()>=6&&!t&&E.addLayer(k.dangerIcons),a>6&&k.dangerIcons.eachLayer(function(a){var e=a.options.icon.options.iconUrl,t=g({iconUrl:e});a.setIcon(t)})}if(k.obs){var n=E.hasLayer(k.obs);E.getZoom()<7&&n?E.removeLayer(k.obs):E.getZoom()>=7&&!n&&E.addLayer(k.obs)}var r=.2;if(k.currentRegion)if(9>=a)A.region.selected.fillOpacity=r,k.currentRegion.setStyle(A.region.selected);else if(a>9&&13>a){switch(a){case 10:r=.15;break;case 11:r=.1;break;case 12:r=.05}A.region.selected.fillOpacity=r,k.currentRegion.setStyle(A.region.selected)}else k.currentRegion.setStyle(A.region.default)}function u(){if(E.hasLayer(k.obs)&&E.removeLayer(k.obs),t.obs.length>0){var a=t.obs.map(function(a){var e=L.marker(a.latlng,{icon:L.mapbox.marker.icon({"marker-size":"small","marker-color":"#09c"})});return e.on("click",function(){r.getOne(a.obid,"html").then(function(a){var t=L.popup({maxWidth:400});t.setContent(a),e.bindPopup(t),e.togglePopup()})}),e.setZIndexOffset(100),e});k.obs=L.featureGroup(a),k.obs.bringToFront()}v()}function f(){k.regions.eachLayer(function(a){a===t.region?a.setStyle(A.region.selected):a.setStyle(A.region.default)})}function m(a){return{type:"Point",coordinates:[a.lng,a.lat]}}function h(){switch(t.device.size){case"xs":return L.point([0,0]);case"sm":return L.point([350,0]);case"md":case"lg":return L.point([480,0]);default:return L.point([0,0])}}function b(){return h().divideBy(2)}function y(a,e){var t=E.latLngToLayerPoint(a);return E.layerPointToLatLng(t.subtract(e))}function w(){var a=b();return y(E.getCenter(),a)}function C(){var a=E.getBounds(),e=E.latLngToLayerPoint(a.getNorthWest()),t=E.latLngToLayerPoint(a.getSouthEast()),n=h(),r=L.bounds(e,t.subtract(n)),s=E.layerPointToLatLng(r.max),o=E.layerPointToLatLng(r.min);return L.latLngBounds(s,o)}function R(){var a=w(),e=E.latLngToLayerPoint(a),t=L.bounds([e.x-50,e.y-50],[e.x+50,e.y+50]),n=E.layerPointToLatLng(t.max),r=E.layerPointToLatLng(t.min);return L.latLngBounds(n,r)}function x(){if(E.getZoom()>=8){var a,e=R(),n=k.regions.getLayers(),r=w(),s=C(),o=_.filter(n,function(a){return e.intersects(a.getBounds())}),i=_.filter(n,function(a){return s.contains(a.getBounds())}),l=_.find(n,function(a){return gju.pointInPolygon(m(r),a.feature.geometry)}),c=_.filter(n,function(a){return s.contains(a.feature.properties.centroid)}),d=_.intersection(o,i);1===d.length?a=d[0]:d.length>1?a=_.min(d,function(a){return a.feature.properties.centroid.distanceTo(r)}):1===c.length?a=c[0]:c.length>1?a=_.min(c,function(a){return a.feature.properties.centroid.distanceTo(r)}):l&&(a=l),t.$apply(function(){t.region=a})}}t.device={};var k={dangerIcons:L.featureGroup()},A={region:{"default":{fillColor:"transparent",color:"transparent"},selected:{fillColor:"#489BDF"},hover:{color:"#B43A7E"},selectedhover:{fillColor:"#489BDF",color:"#B43A7E"}}};L.mapbox.accessToken=o;var E=L.mapbox.map(l[0].id,i,{attributionControl:!1});if(E.setView([52.3,-120.74966],6),L.control.locate({locateOptions:{maxZoom:14}}).addTo(E),n.setBreakpoints({xs:480,sm:600,md:1025}),a.$on("breakpoint",function(a,e){t.device.size=e}),c.topOffset){var I=Number(c.topOffset),S=d(I);angular.element(document).ready(S),angular.element(e).bind("resize",S)}E.on("load",v),E.on("dragend",x),E.on("zoomend",v),t.$watch("region",function(a,e){k.regions&&a&&a!==e&&f()}),t.$watch("regions",function(a,e){a&&a!==e&&a.features&&p()}),t.$watch("obs",function(a){a&&u()})}}}]),angular.module("acComponents.filters").filter("acNormalizeForecastTitle",function(){return function(a){return a?a.replace(/^Avalanche (Forecast|Bulletin) - /g,""):void 0}}),angular.module("acComponents.services").factory("acBreakpoint",["$rootScope","$timeout","$window",function(a,e,t){return{setBreakpoints:function(n){function r(){var r,o=$(t).width();r=o<n.xs?"xs":o>=n.xs&&o<n.sm?"sm":o>=n.sm&&o<n.md?"md":"lg",s&&r===s||(s=r,e(function(){a.$broadcast("breakpoint",s)},0))}var s;r(),angular.element(t).bind("resize",r)}}}]),angular.module("acComponents.services").factory("acForecast",["$http","$q","acImageCache","AC_API_ROOT_URL",function(a,e,t,n){function r(){var a=_.map(s.features,function(a){return o+a.properties.dangerIconUrl});t.cache(a)}var s,o=n;return{fetch:function(){var t=e.defer();return s?t.resolve(s):a.get(o+"/api/forecasts").then(function(a){s=a.data,r(),t.resolve(s)}),t.promise},getOne:function(t){return e.when(this.fetch()).then(function(){var e=_.find(s.features,{id:t});return a.get(o+e.properties.forecastUrl).then(function(a){return a.data})})},getDangerIconUrl:function(a){var e=_.find(s.features,{id:a});return n+e.properties.dangerIconUrl}}}]),angular.module("acComponents.services").factory("acImageCache",["$http",function(a){return{cache:function(e){e.forEach(function(e){a.get(e)})}}}]),angular.module("acComponents.services").factory("acObservation",["$http","AC_API_ROOT_URL",function(a,e){return{byPeriod:function(t){var n={params:{period:t||"2:days"}};return a.get(e+"/api/min/observations",n).then(function(a){return a.data})},getOne:function(t,n){var n="."+n||"",r=e+"/api/min/observations/"+t+n;return a.get(r).then(function(a){return a.data})}}}]),angular.module("acComponents.templates",[]).run(["$templateCache",function(a){a.put("drawer.html",'<div class="ac-drawer"><a ng-click="drawer.visible = false" class="ac-drawer-close visible-xs"><i class="fa fa-close fa-lg"></i></a><div class="ac-drawer-tools"><ul><li ng-click="drawer.visible = !drawer.visible"><i class="fa fa-file-text-o fa-fw fa-2x fa-inverse ac-middle"></i></li></ul></div><div ng-transclude="ng-transclude" class="ac-drawer-body"></div></div>'),a.put("forecast-mini.html",'<div class="panel"><div ng-show="forecast.externalUrl" class="panel-body"><div class="row"><div class="col-xs-12"><h3 class="ac-forecast-region">{{ forecast.name }}</h3></div></div><div class="row"><div class="col-xs-12"><p>Avalanche information for this region is not available in standard format.</p><a ng-href="{{forecast.externalUrl}}" target="_blank"><i class="fa fa-external-link"></i>Click here for more information.</a></div></div></div><div ng-hide="forecast.externalUrl" class="panel-body ac-forecast-mini-body"><div class="row"><div class="col-xs-12"><h4 class="ac-forecast-region">{{ forecast.bulletinTitle | acNormalizeForecastTitle }}</h4></div></div><div class="row ac-forecast-dates"><div class="col-md-6"><dl><dd class="small"><strong class="ac-text-primary">DATE ISSUED</strong></dd><dt class="small"><span class="ac-text-default">{{ forecast.dateIssued | date:\'EEEE MMMM d, y h:mm a\' | uppercase }}</span></dt></dl></div><div class="col-md-6"><dl><dd class="small"><strong class="ac-text-primary">VALID UNTIL</strong></dd><dt class="small"><span class="ac-text-default">{{ forecast.validUntil | date:\'EEEE MMMM d, y h:mm a\' | uppercase }}</span></dt></dl></div></div><div class="row"><div class="col-xs-12"><p class="ac-forecast-highlights"><strong ng-bind-html="forecast.highlights"></strong></p></div></div><div class="row"><div class="col-xs-12"><ul role="tablist" class="nav nav-pills"><li class="active"><a href="" role="tab" data-target="#forecast" data-toggle="tab">Forecast</a></li><li><a href="" role="tab" data-target="#problems" data-toggle="tab">Problems</a></li><li><a href="" role="tab" data-target="#details" data-toggle="tab">Details</a></li><li><a href="/forecasts/{{forecast.region}}" role="tab" data-toggle="tab">Full Page</a></li></ul><div class="tab-content"><div id="forecast" class="tab-pane active"><div class="row"><div class="col-xs-12"><div class="panel panel-primary"><div class="panel-heading">{{ forecast.dangerRatings[0].date | date:\'EEEE\' }}</div><div class="panel-body ac-forecast-nowcast"><img ng-show="forecast.region" ng-src="{{forecast.region &amp;&amp; apiUrl+\'/api/forecasts/\' + forecast.region  + \'/nowcast.svg\' || \'\'}}" class="ac-nowcast"/></div><table class="table table-condensed ac-forecast-days"><thead class="ac-thead-dark"><tr><th></th><th>{{ forecast.dangerRatings[1].date | date:\'EEEE\' }}</th><th>{{ forecast.dangerRatings[2].date | date:\'EEEE\' }}</th></tr></thead><tbody><tr><td class="ac-veg-zone--alp"><strong>Alpine</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.alp.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[1].dangerRating.alp.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.alp.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[2].dangerRating.alp.replace(\':\', \' \') }}</strong></td></tr><tr><td class="ac-veg-zone--tln"><strong>Treeline</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.tln.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[1].dangerRating.tln.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.tln.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[2].dangerRating.tln.replace(\':\', \' \') }}</strong></td></tr><tr><td class="ac-veg-zone--btl"><strong>Bellow Treeline</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.btl.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[1].dangerRating.btl.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.btl.split(\':\')[1].toLowerCase()}}"><strong>{{ forecast.dangerRatings[2].dangerRating.btl.replace(\':\', \' \') }}</strong></td></tr><tr><td><strong>Confidence:</strong></td><td colspan="2"><span class="ac-text-default">{{ forecast.confidence }}</span></td></tr></tbody></table></div></div></div></div><div id="problems" class="tab-pane"><div id="problemsAccordion" class="panel-group"><div ng-repeat="problem in forecast.problems" class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#problem{{$index}}" data-toggle="collapse" data-parent="#problemsAccordion">{{ problem.type }}<i class="fa fa-fw fa-level-down pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="problem{{$index}}" class="panel-collapse collapse"><div class="panel-body"><div class="row"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">What Elevations?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--elevations"><img ng-src="{{problem.icons.elevations}}" class="center-block"/></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">What Aspects?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--aspects"><img ng-src="{{problem.icons.aspects}}" class="center-block"/></div></div></div></div><div class="row"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">Chances of Avalanches?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--likelihood"><img ng-src="{{problem.icons.likelihood}}" class="center-block"/></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">Expected Size?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--expected-size"><img ng-src="{{problem.icons.expectedSize}}" class="center-block"/></div></div></div></div><div class="row"><div class="col-md-12"><p ng-bind-html="problem.comment" class="ac-problem narative"></p><div class="panel panel-default ac-problem-travel-advice"><div class="panel-heading"><strong class="small">Travel and Terrain Advice</strong></div><div class="panel-body"><p ng-bind-html="problem.travelAndTerrainAdvice"></p></div></div></div></div></div></div></div></div></div><div id="details" class="tab-pane"><div id="detailsAccordion" class="panel-group"><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#avalancheSummary" data-toggle="collapse" data-parent="#detailsAccordion">Avalanche Summary<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="avalancheSummary" class="panel-collapse collapse"><div ng-bind-html="forecast.avalancheSummary" class="panel-body"></div></div></div><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#snowpackSummary" data-toggle="collapse" data-parent="#detailsAccordion">Snowpack Summary<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="snowpackSummary" class="panel-collapse collapse"><div ng-bind-html="forecast.snowpackSummary" class="panel-body"></div></div></div><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#weatherForecast" data-toggle="collapse" data-parent="#detailsAccordion">Weather Forecast<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="weatherForecast" class="panel-collapse collapse"><div ng-bind-html="forecast.weatherForecast" class="panel-body"></div></div></div></div></div></div></div></div></div></div>'),a.put("loading-indicator.html",'<div class="ac-loading-indicator"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>')}])}();