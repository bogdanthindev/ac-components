!function(){angular.module("acComponents.config",[]).value("acComponents.config",{debug:!0}).constant("AC_API_ROOT_URL",""),angular.module("acComponents.directives",[]),angular.module("acComponents.filters",[]),angular.module("acComponents.services",[]),angular.module("acComponents",["acComponents.config","acComponents.directives","acComponents.filters","acComponents.services","acComponents.templates","ngSanitize"]),angular.module("acComponents.directives").directive("acDrawer",function(){return{replace:!0,transclude:!0,templateUrl:"drawer.html",link:function(){}}}),angular.module("acComponents.directives").directive("acForecastMini",function(){return{templateUrl:"forecast-mini.html",scope:{forecast:"=acForecast"},link:function(a,e){e.addClass("ac-forecast-mini")}}}),angular.module("acComponents.directives").directive("acLoadingIndicator",function(){return{templateUrl:"loading-indicator.html",replace:!0,link:function(){}}}),angular.module("acComponents.directives").directive("acMapboxMap",["$rootScope","$window","$timeout","acBreakpoint","MAPBOX_ACCESS_TOKEN","MAPBOX_MAP_ID",function(a,e,s,t,n,l){return{template:'<div id="map"></div>',replace:!0,scope:{mapboxAccessToken:"@",mapboxMapId:"@",sidebar:"@acMapSidebar",region:"=acRegion",regions:"=acRegions",obs:"=",filters:"="},link:function(a,e){a.device={};var s={dangerIcons:L.featureGroup()},t={region:{"default":{fillColor:"transparent",color:"transparent"},selected:{fillColor:"#489BDF"}}};L.mapbox.accessToken=n;var i=L.mapbox.map(e[0].id,l,{attributionControl:!1}),r=L.mapbox.geocoder("mapbox.places-province-v1");r.query("British-Columbia",function(a,e){var s=L.latLngBounds([e.bounds[1],e.bounds[0]],[e.bounds[3],e.bounds[2]]);i.fitBounds(s)}),i.on("moveend",function(){s.dangerIcons&&(i.getZoom()<=6&&i.hasLayer(s.dangerIcons)?i.removeLayer(s.dangerIcons):i.getZoom()>6&&!i.hasLayer(s.dangerIcons)&&i.addLayer(s.dangerIcons))}),i.on("zoomend",function(){var a=i.getZoom(),e=.2;if(s.currentRegion)if(9>=a)t.region.selected.fillOpacity=e,s.currentRegion.setStyle(t.region.selected);else if(a>9&&13>a){switch(a){case 10:e=.15;break;case 11:e=.1;break;case 12:e=.05}t.region.selected.fillOpacity=e,s.currentRegion.setStyle(t.region.selected)}else s.currentRegion.setStyle(t.region.default)}),a.$watch("region",function(a){a&&s.regions&&s.regions.eachLayer(function(e){var n=e===a?t.region.selected:t.region.default;e.setStyle(n),s.currentRegion=e})}),a.$watch("regions",function(e){e&&e.features&&(s.regions=L.geoJson(a.regions,{style:function(){return t.region.default},onEachFeature:function(e,t){function n(e){i.getZoom()<9?i.fitBounds(t.getBounds()):i.panTo(e.latlng),a.$apply(function(){a.region=t})}if(t.bindLabel(e.properties.name,{noHide:!0}),t.on("click",n),e.properties.centroid){var l=L.latLng(e.properties.centroid[1],e.properties.centroid[0]);L.marker(l,{icon:L.icon({iconUrl:"http://localhost:9000"+e.properties.dangerIconUrl,iconSize:[80,80]})}).on("click",n).addTo(s.dangerIcons)}}}).addTo(i))})}}}]),angular.module("acComponents.filters").filter("acNormalizeForecastTitle",function(){return function(a){return a?a.replace(/^Avalanche (Forecast|Bulletin) - /g,""):void 0}}),angular.module("acComponents.services").factory("acBreakpoint",["$rootScope","$timeout","$window",function(a,e,s){return{setBreakpoints:function(t){function n(){var n,i=$(s).width();n=i<t.xs?"xs":i>=t.xs&&i<t.sm?"sm":i>=t.sm&&i<t.md?"md":"lg",l&&n===l||(l=n,e(function(){a.$broadcast("breakpoint",l)},0))}var l;n(),angular.element(s).bind("resize",n)}}}]),angular.module("acComponents.services").factory("acForecast",["$http","$q","acImageCache","AC_API_ROOT_URL",function(a,e,s,t){function n(){var a=_.map(l.features,function(a){return i+a.properties.dangerIconUrl});s.cache(a)}var l,i=t;return{fetch:function(){var s=e.defer();return l?s.resolve(l):a.get(i+"/api/forecasts").then(function(a){l=a.data,n(),s.resolve(l)}),s.promise},getOne:function(s){return e.when(this.fetch()).then(function(){return s=_.find(l.features,{id:s}),a.get(i+s.properties.forecastUrl).then(function(a){return a.data})})}}}]),angular.module("acComponents.services").factory("acImageCache",["$http",function(a){return{cache:function(e){e.forEach(function(e){a.get(e)})}}}]),angular.module("acComponents.services").factory("acObservation",["$http",function(a){return{byPeriod:function(e){var s={params:{period:e}};return a.get("api/observations",s).then(function(a){return a.data})}}}]),angular.module("acComponents.templates",[]).run(["$templateCache",function(a){a.put("drawer.html",'<div class="ac-drawer"><a ng-click="drawer.visible = false" class="ac-drawer-close visible-xs"><i class="fa fa-close fa-lg"></i></a><div class="ac-drawer-tools"><ul><li ng-click="drawer.visible = !drawer.visible"><i class="fa fa-file-text-o fa-fw fa-2x fa-inverse ac-middle"></i></li></ul></div><div ng-transclude="ng-transclude" class="ac-drawer-body"></div></div>'),a.put("forecast-mini.html",'<div class="panel"><div ng-show="forecast.externalUrl" class="panel-body"><div class="row"><div class="col-xs-12"><h3 class="ac-forecast-region">{{ forecast.name }}</h3></div></div><div class="row"><div class="col-xs-12"><p>The avalanche forecast for this region is produced by one of our partner agencies. \nThe link below will take you to the forecast page on the partner agency\'s own website.</p><a ng-href="{{forecast.externalUrl}}" target="_blank"><i class="fa fa-external-link"></i>  Open partner forecast in new window.</a></div></div></div><div ng-hide="forecast.externalUrl" class="panel-body ac-forecast-mini-body"><div class="row"><div class="col-xs-12"><h4 class="ac-forecast-region">{{ forecast.bulletinTitle | acNormalizeForecastTitle }}</h4></div></div><div class="row ac-forecast-dates"><div class="col-md-6"><dl><dd class="small"><strong class="ac-text-primary">DATE ISSUED </strong></dd><dt class="small"><span class="ac-text-default">{{ forecast.dateIssued | date:\'EEEE MMMM d, y h:mm a\' | uppercase }}</span></dt></dl></div><div class="col-md-6"><dl><dd class="small"><strong class="ac-text-primary">VALID UNTIL</strong></dd><dt class="small"><span class="ac-text-default">{{ forecast.validUntil | date:\'EEEE MMMM d, y h:mm a\' | uppercase }}</span></dt></dl></div></div><div class="row"><div class="col-xs-12"><p class="ac-forecast-highlights"><strong ng-bind-html="forecast.highlights"></strong></p></div></div><div class="row"><div class="col-xs-12"><ul role="tablist" class="nav nav-pills"><li class="active"><a href="" role="tab" data-target="#forecast" data-toggle="tab">Forecast</a></li><li><a href="" role="tab" data-target="#problems" data-toggle="tab">Problems</a></li><li><a href="" role="tab" data-target="#details" data-toggle="tab">Details</a></li></ul><div class="tab-content"><div id="forecast" class="tab-pane active"><div class="row"><div class="col-xs-12"><div class="panel panel-primary"><div class="panel-heading">{{ forecast.dangerRatings[0].date | date:\'EEEE\' }}</div><div class="panel-body ac-forecast-nowcast"><img ng-show="forecast.region" ng-src="{{forecast.region &amp;&amp; \'http://localhost:9000/api/forecasts/\' + forecast.region  + \'/nowcast.svg\' || \'\'}}" class="ac-nowcast"/></div><table class="table table-condensed ac-forecast-days"><thead class="ac-thead-dark"><tr><th></th><th>{{ forecast.dangerRatings[1].date | date:\'EEEE\' }}</th><th>{{ forecast.dangerRatings[2].date | date:\'EEEE\' }}</th></tr></thead><tbody><tr><td class="ac-veg-zone--alp"> <strong>Alpine</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.alp.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[1].dangerRating.alp.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.alp.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[2].dangerRating.alp.replace(\':\', \' \') }}</strong></td></tr><tr><td class="ac-veg-zone--tln"> <strong>Treeline</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.tln.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[1].dangerRating.tln.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.tln.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[2].dangerRating.tln.replace(\':\', \' \') }}</strong></td></tr><tr><td class="ac-veg-zone--btl"> <strong>Bellow Treeline</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[1].dangerRating.btl.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[1].dangerRating.btl.replace(\':\', \' \') }}</strong></td><td class="ac-danger-rating--{{ forecast.dangerRatings[2].dangerRating.btl.split(\':\')[1].toLowerCase()}}"> <strong>{{ forecast.dangerRatings[2].dangerRating.btl.replace(\':\', \' \') }}</strong></td></tr><tr><td><strong>Confidence:</strong></td><td colspan="2"><span class="ac-text-default">{{ forecast.confidence }}</span></td></tr></tbody></table></div></div></div></div><div id="problems" class="tab-pane"><div id="problemsAccordion" class="panel-group"><div ng-repeat="problem in forecast.problems" class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#problem{{$index}}" data-toggle="collapse" data-parent="#problemsAccordion">{{ problem.type }}<i class="fa fa-fw fa-level-down pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="problem{{$index}}" class="panel-collapse collapse"><div class="panel-body"><div class="row"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">What Elevations?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--elevations"><img ng-src="{{problem.icons.elevations}}" class="center-block"/></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">What Aspects?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--aspects"><img ng-src="{{problem.icons.aspects}}" class="center-block"/></div></div></div></div><div class="row"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">Chances of Avalanches?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--likelihood"><img ng-src="{{problem.icons.likelihood}}" class="center-block"/></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading"><strong class="small">Expected Size?</strong></div><div class="panel-body ac-problem-icon ac-problem-icon--expected-size"><img ng-src="{{problem.icons.expectedSize}}" class="center-block"/></div></div></div></div><div class="row"><div class="col-md-12"><p ng-bind-html="problem.comment" class="ac-problem narative"></p><div class="panel panel-default ac-problem-travel-advice"><div class="panel-heading"><strong class="small">Travel and Terrain Advice</strong></div><div class="panel-body"><p ng-bind-html="problem.travelAndTerrainAdvice"></p></div></div></div></div></div></div></div></div></div><div id="details" class="tab-pane"><div id="detailsAccordion" class="panel-group"><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#avalancheSummary" data-toggle="collapse" data-parent="#detailsAccordion">Avalanche Summary<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="avalancheSummary" class="panel-collapse collapse"><div ng-bind-html="forecast.avalancheSummary" class="panel-body"></div></div></div><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#snowpackSummary" data-toggle="collapse" data-parent="#detailsAccordion">Snowpack Summary<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="snowpackSummary" class="panel-collapse collapse"><div ng-bind-html="forecast.snowpackSummary" class="panel-body"></div></div></div><div class="panel panel-primary"><div class="panel-heading"><h4 class="panel-title"><a href="" data-target="#weatherForecast" data-toggle="collapse" data-parent="#detailsAccordion">Weather Forecast<i class="fa fa-fw fa-level-down fa-lg pull-right"></i><small class="pull-right">click to expand</small></a></h4></div><div id="weatherForecast" class="panel-collapse collapse"><div ng-bind-html="forecast.weatherForecast" class="panel-body"></div></div></div></div></div></div></div></div></div></div>'),a.put("loading-indicator.html",'<div class="ac-loading-indicator"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>')}])}();